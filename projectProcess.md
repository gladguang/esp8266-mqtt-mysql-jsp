# 温湿度存储


## 项目说明：


#### 1.温湿度传感器数据通过 ESP8266 传输到 EQM-X
#### 2.EQM-X 将数据存储到mySQL数据库
#### 3.网站或应用端程序可以从数据库或者EQM-X读取数据。网站能发送数据到EQM_X再传输给ESP8266，使ESP8266响应相关动作。

## 实现相关


### 1. 数据发送

- 硬件材料
>+ 安信可NodeMCU-12S(ESP8266  CH340芯片) 开发板
>+ 面包板、杜邦线、带通讯功能的Macro USB线、SHTC3数字型温湿度传感器
>


- 软件
> + Arduino软件
>> ##### 所需安装依赖
>> * 安装 ESP8266 开发板 点击 工具 -> 开发板 -> 开发板管理 -> 搜索 ESP8266 -> 点击安装
>> * 安装 PubSub client 库 项目 -> 加载库 -> 管理库... -> 搜索 PubSubClient -> 安装 PubSubClient by Nick O’Leary
> + ComAssistant.exe
>  + NetAssist v4.3.25.exe
> 


#### 实现技术要点

1. 可自主选择ESP8266连接WIFI，且连接WIFI后不会按reset键后恢复。并将WIFI连接信息打印到串口。[^1][^2]

[^1]: 将所连接的WIFI的ip、ssid打印出来
[^2]: 能提示WIFI是否连接成功信息。

相关实现代码:
```
TODO:
```
2. 实现ESP8266接收到温湿度传感器数据，且将数据转换成 json 格式。
相关实现代码:
```
TODO:
```
3. 实现ESP8266通过MQTT协议与EMQ-X服务器的订阅与数据发送
相关实现代码:
```
TODO:
```


### 2. 数据存储

- 硬件所需：无
- 软件：
> EMQ X客户端


#### 技术实现要点
1. 通过自带的WebHook。[^3]

[^3]: WebHook处理事件是单向的，仅支持EMQ-X事件推送给Web服务，不关心Web服务返回。借助WebHook可以完成设备在线、上下线记录，订阅与消息存储、消息送达确认等业务。

2. MQTT客户端订阅消息再转存数据库

> 1. 后台再开个超级权限MQTT客户端
> 2. 订阅所需主题
> 3. Qos设置成2。保证只接受到1次。
> 4.将接收到的消息存储到数据库。
> 

相关实现代码:
```
TODO:
```

### 3. 数据库的建立
- 建立mqtt数据库
- 建表。表名为esp_temperature
- 字段约束

```
CREATE DATABASE mqtt;

USE  mqtt;

# 字段约束
TODO：

```

### 4. 网页或客户端显示相关数据

- 硬件所需：无
- 软件：
> IDEA 


#### 技术实现要点：

1. 与数据库交互

相关实现代码:
```
TODO:
```
2. 用jsp显示实时温湿度数据及时间

相关实现代码:
```
TODO:
```
3. 能查询历史数据

相关实现代码:
```
TODO:
```
4.与ESP8266交互。将8266上的小灯开启和熄灭。

相关实现代码:
```
TODO:
```